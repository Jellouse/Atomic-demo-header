<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- viewport-fit=cover is essential for the content to go under the notch -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Atomic Ski Design Concept</title>
    
    <!-- Initial theme color -->
    <meta name="theme-color" content="#808080">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            /* Removed fixed black background. It is now dynamic via JS. */
            /* We set a default to prevent flash, but JS will take over. */
            background-color: #808080; 
            color: #111; /* Text is now dark for the white theme */
            overflow-x: hidden;
            transition: background-color 0.3s ease; /* Smooth transition for the body color */
        }

        .atomic-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 110px;
            z-index: 50;
            
            /* 50% White Opacity as requested */
            background-color: rgba(255, 255, 255, 0.5); 
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            
            /* Trapezoid Notch */
            clip-path: polygon(
                0 0, 
                100% 0, 
                100% 65%, 
                58% 65%, 
                54% 100%, 
                46% 100%, 
                42% 65%, 
                0 65%
            );
            
            transition: background-color 0.3s ease;
        }

        .top-bar {
            height: 40%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
            letter-spacing: 0.1em;
            font-weight: 600;
            color: #111;
            text-transform: uppercase;
            padding-bottom: 5px;
        }

        .nav-row {
            position: absolute;
            top: 25px;
            width: 100%;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: black;
        }

        .logo-container {
            position: absolute;
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
            color: black;
            z-index: 60;
        }

        .gallery-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        .gallery-item:hover .gallery-img {
            transform: scale(1.05);
        }
        .gallery-item {
            overflow: hidden;
            position: relative;
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="atomic-header" id="main-header">
        <div class="top-bar">
            Free Delivery + 30 Days Return
        </div>
        <div class="nav-row">
            <button class="p-2 hover:opacity-60 transition">
                <i data-lucide="menu" stroke-width="1.5" size="24"></i>
            </button>
            <button class="p-2 hover:opacity-60 transition">
                <i data-lucide="shopping-bag" stroke-width="1.5" size="24"></i>
            </button>
        </div>
        <div class="logo-container">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2L15 10L23 10L17 15L19 23L12 18L5 23L7 15L1 10L9 10L12 2Z" fill="black"/>
            </svg>
        </div>
    </header>

    <!-- Content Wrapper -->
    <!-- We force this to be white to separate content from the dynamic body background -->
    <main class="relative w-full bg-white z-10">
        
        <!-- Hero -->
        <div class="relative w-full h-[110vh] overflow-hidden bg-gray-200">
            <img 
                id="hero-image"
                src="https://images.unsplash.com/photo-1551698618-1dfe5d97d256?q=80&w=2940&auto=format&fit=crop" 
                alt="Skier"
                class="absolute top-0 left-0 w-full h-full object-cover grayscale"
                crossorigin="anonymous"
                onerror="console.log('Image failed to load')"
            />
            
            <div class="absolute top-[45%] left-0 w-full text-center px-6 mix-blend-difference text-white">
                <h1 class="text-5xl md:text-7xl font-bold tracking-tighter mb-4 drop-shadow-xl">
                    REDSTER
                </h1>
                <button class="mt-8 px-10 py-3 border border-white text-white rounded-full font-bold text-sm uppercase tracking-widest hover:bg-white hover:text-black transition duration-300">
                    Explore
                </button>
            </div>
        </div>

        <!-- Gallery -->
        <section class="relative z-10 bg-white pb-20">
            <!-- Status Indicator for Debugging -->
            <div id="status-bar" class="w-full py-4 text-[10px] text-center text-gray-400 uppercase font-mono border-b border-gray-100">
                System Status: <span id="tint-value">Initializing...</span>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-1">
                <div class="gallery-item aspect-[4/5]">
                    <img src="https://images.unsplash.com/photo-1605540436563-5bca919ae766?q=80&w=2000&auto=format&fit=crop" class="gallery-img grayscale">
                    <div class="absolute bottom-6 left-6 text-white drop-shadow-md">
                        <h3 class="uppercase text-2xl font-bold tracking-tighter">Backcountry</h3>
                    </div>
                </div>
                <div class="gallery-item aspect-[4/5]">
                    <img src="https://images.unsplash.com/photo-1520520731457-9283dd14aa66?q=80&w=2000&auto=format&fit=crop" class="gallery-img grayscale">
                    <div class="absolute bottom-6 left-6 text-white drop-shadow-md">
                        <h3 class="uppercase text-2xl font-bold tracking-tighter">Race</h3>
                    </div>
                </div>
                <div class="gallery-item aspect-square md:col-span-2">
                    <img src="https://images.unsplash.com/photo-1486915309851-b962004d7781?q=80&w=2000&auto=format&fit=crop" class="gallery-img grayscale">
                    <div class="absolute bottom-6 left-6 text-white drop-shadow-md">
                        <h3 class="uppercase text-2xl font-bold tracking-tighter">All Mountain</h3>
                    </div>
                </div>
            </div>
            
            <div class="p-10 text-black">
                <h2 class="text-3xl font-bold uppercase tracking-tight mb-4">Engineered in Austria</h2>
                <p class="text-gray-600 max-w-md text-sm leading-relaxed">
                    Every Atomic ski is built with a passion for the sport. 
                    Our Redster technology brings World Cup speed to your local piste.
                </p>
            </div>
        </section>
        
        <footer class="bg-white text-black py-12 text-center text-xs border-t border-gray-200 tracking-widest">
            &copy; 2025 ATOMIC SKI
        </footer>
    </main>

    <!-- Hidden Canvas -->
    <canvas id="analysis-canvas" class="hidden"></canvas>

    <script>
        lucide.createIcons();

        /* --- SAFARI TINTING LOGIC --- */

        const heroImg = document.getElementById('hero-image');
        const canvas = document.getElementById('analysis-canvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        const metaThemeColor = document.querySelector('meta[name="theme-color"]');
        const tintStatus = document.getElementById('tint-value');
        
        const HEADER_HEIGHT = 110; 
        const WHITE_OVERLAY_ALPHA = 0.50;
        const WHITE_RGB = { r: 255, g: 255, b: 255 };

        let isImageLoaded = false;
        let isTainted = false;

        setTimeout(updateThemeColor, 500);

        if (heroImg.complete) {
            initCanvas();
        } else {
            heroImg.onload = initCanvas;
            heroImg.onerror = () => {
                tintStatus.innerText = "Img Error (Defaulting)";
                updateThemeColor(); 
            };
        }

        function initCanvas() {
            try {
                canvas.width = heroImg.naturalWidth;
                canvas.height = heroImg.naturalHeight;
                ctx.drawImage(heroImg, 0, 0);
                isImageLoaded = true;
                tintStatus.innerText = "Canvas Ready";
                updateThemeColor();
            } catch(e) {
                console.error("Canvas Tainted", e);
                isTainted = true;
                tintStatus.innerText = "Security Block (Defaulting)";
            }
        }

        function getAverageColor(sampleY, sampleHeight) {
            if (!isImageLoaded || isTainted) return { r: 128, g: 128, b: 128 }; // Default grey

            const displayHeight = heroImg.getBoundingClientRect().height;
            const scale = canvas.height / displayHeight;
            
            const sourceY = Math.max(0, sampleY * scale);
            const sourceH = Math.min(canvas.height - sourceY, sampleHeight * scale);
            
            if (sourceH <= 0) return { r: 255, g: 255, b: 255 }; // Passed image -> White

            try {
                const imageData = ctx.getImageData(0, sourceY, canvas.width, sourceH);
                const data = imageData.data;
                let r = 0, g = 0, b = 0, count = 0;

                for (let i = 0; i < data.length; i += 200) {
                    r += data[i];
                    g += data[i+1];
                    b += data[i+2];
                    count++;
                }

                if(count === 0) return { r:255, g:255, b:255 };

                return {
                    r: Math.round(r / count),
                    g: Math.round(g / count),
                    b: Math.round(b / count)
                };
            } catch (e) {
                isTainted = true;
                return { r: 128, g: 128, b: 128 };
            }
        }

        function blendWithWhite(rgb) {
            const r = Math.round((rgb.r * (1 - WHITE_OVERLAY_ALPHA)) + (WHITE_RGB.r * WHITE_OVERLAY_ALPHA));
            const g = Math.round((rgb.g * (1 - WHITE_OVERLAY_ALPHA)) + (WHITE_RGB.g * WHITE_OVERLAY_ALPHA));
            const b = Math.round((rgb.b * (1 - WHITE_OVERLAY_ALPHA)) + (WHITE_RGB.b * WHITE_OVERLAY_ALPHA));
            return { r, g, b };
        }

        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }

        function updateThemeColor() {
            const scrollY = window.scrollY;
            const heroRect = heroImg.getBoundingClientRect();
            let finalColorHex = "#ffffff"; 

            if (heroRect.bottom > 0) {
                // Over the image: Calculate tint
                const avgColor = getAverageColor(scrollY, HEADER_HEIGHT);
                const blendedColor = blendWithWhite(avgColor);
                finalColorHex = rgbToHex(blendedColor.r, blendedColor.g, blendedColor.b);
            } else {
                // Passed the image: White content
                // 50% White Header over White Content = White (#ffffff)
                finalColorHex = "#ffffff";
            }

            // 1. Update Meta Tag (For Status Bar)
            if(metaThemeColor.getAttribute('content') !== finalColorHex) {
                metaThemeColor.setAttribute('content', finalColorHex);
                tintStatus.innerText = "Active: " + finalColorHex;
                
                // 2. Update Body Background (For Overscroll/Bounce)
                document.body.style.backgroundColor = finalColorHex;
            }
        }

        function throttle(func, limit) {
            let inThrottle;
            return function() {
                const args = arguments;
                const context = this;
                if (!inThrottle) {
                    func.apply(context, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            }
        }

        window.addEventListener('scroll', throttle(updateThemeColor, 50));
        window.addEventListener('resize', throttle(initCanvas, 500));
    </script>
</body>
</html>