<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Atomic Ski Design Concept</title>
    <!-- Initial theme color (will be updated by JS) -->
    <meta name="theme-color" content="#cccccc">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #000;
            color: white;
            overflow-x: hidden;
        }

        /* The Header Shape 
           Updated to a Trapezoid Notch
        */
        .atomic-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 110px; /* Slightly taller for the deep notch */
            z-index: 50;
            
            /* Requested 50% White Opacity */
            background-color: rgba(255, 255, 255, 0.5); 
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            
            /* Trapezoid Notch Logic:
               Main bar ends at 65% height.
               Trapezoid extends from 42% width to 58% width at the top of the notch,
               narrowing to 46% width and 54% width at the bottom (100% height).
            */
            clip-path: polygon(
                0 0, 
                100% 0, 
                100% 65%, 
                58% 65%, 
                54% 100%, 
                46% 100%, 
                42% 65%, 
                0 65%
            );
            
            transition: background-color 0.3s ease;
        }

        .top-bar {
            height: 40%; /* Occupies top part of the 65% main bar */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
            letter-spacing: 0.1em;
            font-weight: 600;
            color: #111;
            text-transform: uppercase;
            padding-bottom: 5px;
        }

        .nav-row {
            position: absolute;
            top: 25px; /* Adjusted for new height */
            width: 100%;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: black;
        }

        .logo-container {
            position: absolute;
            bottom: 12px; /* Positioned inside the trapezoid tip */
            left: 50%;
            transform: translateX(-50%);
            color: black;
            z-index: 60;
        }

        /* Image Grid Styles */
        .gallery-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        .gallery-item:hover .gallery-img {
            transform: scale(1.05);
        }
        .gallery-item {
            overflow: hidden;
            position: relative;
        }
    </style>
</head>
<body>

    <!-- The Dynamic Header -->
    <header class="atomic-header" id="main-header">
        <div class="top-bar">
            Free Delivery + 30 Days Return
        </div>
        <div class="nav-row">
            <!-- Hamburger Menu -->
            <button class="p-2 hover:opacity-60 transition">
                <i data-lucide="menu" stroke-width="1.5" size="24"></i>
            </button>
            
            <!-- Bag Icon -->
            <button class="p-2 hover:opacity-60 transition">
                <i data-lucide="shopping-bag" stroke-width="1.5" size="24"></i>
            </button>
        </div>
        
        <!-- Center Logo -->
        <div class="logo-container">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2L15 10L23 10L17 15L19 23L12 18L5 23L7 15L1 10L9 10L12 2Z" fill="black"/>
            </svg>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="relative w-full bg-black">
        
        <!-- Hero Section -->
        <div class="relative w-full h-[110vh] overflow-hidden">
            <img 
                id="hero-image"
                src="https://images.unsplash.com/photo-1551698618-1dfe5d97d256?q=80&w=2940&auto=format&fit=crop" 
                alt="Skier in black and white"
                class="absolute top-0 left-0 w-full h-full object-cover grayscale"
                crossorigin="anonymous"
            />
            
            <div class="absolute top-[45%] left-0 w-full text-center px-6 mix-blend-difference text-white">
                <h1 class="text-5xl md:text-7xl font-bold tracking-tighter mb-4 drop-shadow-xl">
                    REDSTER
                </h1>
                <button class="mt-8 px-10 py-3 border border-white text-white rounded-full font-bold text-sm uppercase tracking-widest hover:bg-white hover:text-black transition duration-300">
                    Explore
                </button>
            </div>
        </div>

        <!-- Image Grid (Replaced random content) -->
        <section class="relative z-10 bg-black">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-1">
                
                <!-- Item 1 -->
                <div class="gallery-item aspect-[4/5]">
                    <img src="https://images.unsplash.com/photo-1605540436563-5bca919ae766?q=80&w=2000&auto=format&fit=crop" class="gallery-img grayscale" alt="Ski Texture">
                    <div class="absolute bottom-6 left-6 text-white">
                        <h3 class="uppercase text-2xl font-bold tracking-tighter">Backcountry</h3>
                        <p class="text-xs tracking-widest mt-1 opacity-80">Maverick Series</p>
                    </div>
                </div>

                <!-- Item 2 -->
                <div class="gallery-item aspect-[4/5]">
                    <img src="https://images.unsplash.com/photo-1520520731457-9283dd14aa66?q=80&w=2000&auto=format&fit=crop" class="gallery-img grayscale" alt="Ski Jump">
                    <div class="absolute bottom-6 left-6 text-white">
                        <h3 class="uppercase text-2xl font-bold tracking-tighter">Race</h3>
                        <p class="text-xs tracking-widest mt-1 opacity-80">Redster G9</p>
                    </div>
                </div>

                <!-- Item 3 -->
                <div class="gallery-item aspect-square md:col-span-2">
                    <img src="https://images.unsplash.com/photo-1486915309851-b962004d7781?q=80&w=2000&auto=format&fit=crop" class="gallery-img grayscale" alt="Mountain Peak">
                    <div class="absolute bottom-6 left-6 text-white">
                        <h3 class="uppercase text-2xl font-bold tracking-tighter">All Mountain</h3>
                        <p class="text-xs tracking-widest mt-1 opacity-80">Bent Chetler</p>
                    </div>
                </div>

                <!-- Item 4 -->
                <div class="gallery-item aspect-[4/5]">
                    <img src="https://images.unsplash.com/photo-1565992441121-4367c2967103?q=80&w=2000&auto=format&fit=crop" class="gallery-img grayscale" alt="Ski Gear">
                    <div class="absolute bottom-6 left-6 text-white">
                        <h3 class="uppercase text-2xl font-bold tracking-tighter">Protection</h3>
                        <p class="text-xs tracking-widest mt-1 opacity-80">Helmets & Goggles</p>
                    </div>
                </div>

                 <!-- Item 5 -->
                 <div class="gallery-item aspect-[4/5]">
                    <img src="https://images.unsplash.com/photo-1414235077428-338989a2e8c0?q=80&w=2000&auto=format&fit=crop" class="gallery-img grayscale" alt="Powder Turn">
                    <div class="absolute bottom-6 left-6 text-white">
                        <h3 class="uppercase text-2xl font-bold tracking-tighter">Touring</h3>
                        <p class="text-xs tracking-widest mt-1 opacity-80">Backland</p>
                    </div>
                </div>

            </div>
            
            <!-- Debug Info (Hidden visually but kept for logic) -->
            <div class="p-6 text-xs text-gray-700 font-mono opacity-0">
                Tint: <span id="debug-hex">#CCCCCC</span>
            </div>
        </section>
        
        <footer class="bg-black text-white py-12 text-center text-xs opacity-50 tracking-widest">
            ENGINEERED IN AUSTRIA &copy; 2025
        </footer>

    </main>

    <!-- Hidden Canvas -->
    <canvas id="analysis-canvas" class="hidden"></canvas>

    <script>
        lucide.createIcons();

        /* --- SAFARI TINTING LOGIC --- */

        const heroImg = document.getElementById('hero-image');
        const canvas = document.getElementById('analysis-canvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        const metaThemeColor = document.querySelector('meta[name="theme-color"]');
        const debugHex = document.getElementById('debug-hex');
        
        // Configuration Updated
        const HEADER_HEIGHT = 110; 
        const WHITE_OVERLAY_ALPHA = 0.50; // Updated to 50%
        const WHITE_RGB = { r: 255, g: 255, b: 255 };

        let isImageLoaded = false;

        if (heroImg.complete) {
            initCanvas();
        } else {
            heroImg.onload = initCanvas;
        }

        function initCanvas() {
            canvas.width = heroImg.naturalWidth;
            canvas.height = heroImg.naturalHeight;
            ctx.drawImage(heroImg, 0, 0);
            isImageLoaded = true;
            updateThemeColor();
        }

        function getAverageColor(sampleY, sampleHeight) {
            if (!isImageLoaded) return { r: 0, g: 0, b: 0 };

            const displayHeight = heroImg.getBoundingClientRect().height;
            const scale = canvas.height / displayHeight;
            
            const sourceY = Math.max(0, sampleY * scale);
            const sourceH = Math.min(canvas.height - sourceY, sampleHeight * scale);
            
            if (sourceH <= 0) return { r: 0, g: 0, b: 0 };

            try {
                const imageData = ctx.getImageData(0, sourceY, canvas.width, sourceH);
                const data = imageData.data;
                let r = 0, g = 0, b = 0, count = 0;

                for (let i = 0; i < data.length; i += 40) {
                    r += data[i];
                    g += data[i+1];
                    b += data[i+2];
                    count++;
                }

                return {
                    r: Math.round(r / count),
                    g: Math.round(g / count),
                    b: Math.round(b / count)
                };
            } catch (e) {
                return { r: 0, g: 0, b: 0 };
            }
        }

        function blendWithWhite(rgb) {
            const r = Math.round((rgb.r * (1 - WHITE_OVERLAY_ALPHA)) + (WHITE_RGB.r * WHITE_OVERLAY_ALPHA));
            const g = Math.round((rgb.g * (1 - WHITE_OVERLAY_ALPHA)) + (WHITE_RGB.g * WHITE_OVERLAY_ALPHA));
            const b = Math.round((rgb.b * (1 - WHITE_OVERLAY_ALPHA)) + (WHITE_RGB.b * WHITE_OVERLAY_ALPHA));
            return { r, g, b };
        }

        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }

        function updateThemeColor() {
            const scrollY = window.scrollY;
            const heroRect = heroImg.getBoundingClientRect();
            let finalColorHex = "#ffffff"; 

            // Tinting logic mainly applies when over the Hero image
            if (heroRect.bottom > 0) {
                const avgColor = getAverageColor(scrollY, HEADER_HEIGHT);
                const blendedColor = blendWithWhite(avgColor);
                finalColorHex = rgbToHex(blendedColor.r, blendedColor.g, blendedColor.b);
            } else {
                // When over the black gallery content:
                // Background is Black (0,0,0). 
                // Overlay is White 50%. 
                // Result = 50% Grey (#808080).
                // We can hardcode this for performance or calculate it.
                // Since the gallery images are dynamic, let's just default to a dark grey for simplicity
                // or keep it white if that's the desired "nav" look. 
                // Given the "Atomic" look, usually UI stays consistent.
                // Let's blend Black with 50% White -> #808080
                finalColorHex = "#808080";
            }

            metaThemeColor.setAttribute('content', finalColorHex);
            if(debugHex) debugHex.innerText = finalColorHex;
        }

        function throttle(func, limit) {
            let inThrottle;
            return function() {
                const args = arguments;
                const context = this;
                if (!inThrottle) {
                    func.apply(context, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            }
        }

        window.addEventListener('scroll', throttle(updateThemeColor, 50));
        window.addEventListener('resize', throttle(initCanvas, 500));
    </script>
</body>
</html>